---
import { getCollection } from "astro:content";
import BlogPostLayout from "../../layouts/BlogPostLayout.astro";

/**
 * Gera rotas para todos os posts .md em src/content/blog
 * (exceto drafts).
 */
export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts
    // Evita slugs com subpastas (ex: "bkp/post"), que quebram a rota /blog/[slug]
    .filter((p) => !p.slug.includes("/"))
    .filter((p) => !p.data.draft)
    .map((p) => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;

const posts = await getCollection("blog");
const entry = posts.find((p) => p.slug === slug && !p.slug.includes("/"));

if (!entry) {
  return Astro.redirect("/404");
}

const { Content } = await entry.render();
---

<BlogPostLayout {...entry.data}>
  <Content />
</BlogPostLayout>
