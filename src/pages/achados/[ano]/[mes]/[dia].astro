---
import Layout from "@/layouts/Layout.astro";
import EditionPage from "@/components/EditionPage.astro";
import { getDailyEditionByDate, listAvailableDates, listCategoriesForDate } from "@/lib/achadosSource";
import { titleFromSlug } from "@/lib/slug";

// Gera páginas somente para datas existentes no JSON (SEO limpo + evita 404)
export function getStaticPaths() {
  return listAvailableDates().map((date) => {
    const [ano, mes, dia] = date.split("-");
    return { params: { ano, mes, dia } };
  });
}

const { ano, mes, dia } = Astro.params;
const date = `${ano}-${mes}-${dia}`;
const edition = getDailyEditionByDate(date);

if (!edition) {
  throw new Error(`Edição diária não encontrada: ${date}`);
}

const cats = listCategoriesForDate(date);
const pageTitle = `${edition.title} (${date}) | Achados do dia`;
const pageDesc = edition.intro ?? `Top 10 de achados em ${dia}/${mes}/${ano}.`;
---

<Layout title={pageTitle} description={pageDesc}>
  <section class="space-y-10">
    <EditionPage edition={edition} showHighlights={true} />

    {cats.length ? (
      <section class="space-y-4">
        <h2 class="text-lg font-semibold">Categorias publicadas neste dia</h2>
        <div class="flex flex-wrap gap-2">
          {cats.map((c) => (
            <a
              class="rounded-full border border-slate-200 bg-white px-3 py-1 text-sm hover:bg-slate-50 transition"
              href={`/achados/${ano}/${mes}/${dia}/${c}`}
            >
              {titleFromSlug(c)}
            </a>
          ))}
        </div>
      </section>
    ) : null}

    <div>
      <a href="/achados" class="text-sm font-semibold text-[var(--bazarino-blue)] hover:underline">← Voltar para Achados</a>
    </div>
  </section>
</Layout>
