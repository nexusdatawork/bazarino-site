---
import Layout from "@/layouts/Layout.astro";
import EditionPage from "@/components/EditionPage.astro";
import { getCategoryEditionByDate, listCategoryDayRoutes } from "@/lib/achadosSource";
import { titleFromSlug } from "@/lib/slug";

// Gera páginas somente para (data + categoria) existentes no JSON
export function getStaticPaths() {
  return listCategoryDayRoutes().map(({ date, category }) => {
    const [ano, mes, dia] = date.split("-");
    return { params: { ano, mes, dia, categoria: category } };
  });
}

const { ano, mes, dia, categoria } = Astro.params;
const date = `${ano}-${mes}-${dia}`;
const edition = getCategoryEditionByDate(date, categoria);

if (!edition) {
  throw new Error(`Edição de categoria não encontrada: ${date} / ${categoria}`);
}

const title = `${titleFromSlug(categoria)} • ${dia}/${mes}/${ano}`;
const pageTitle = `${title} | Achados por categoria`;
const pageDesc = edition.intro ?? `Top da categoria ${titleFromSlug(categoria)} em ${dia}/${mes}/${ano}.`;
---

<Layout title={pageTitle} description={pageDesc}>
  <section class="space-y-10">
    <div class="flex flex-wrap items-center justify-between gap-3">
      <a href={`/achados/${ano}/${mes}/${dia}`} class="text-sm font-semibold text-[var(--bazarino-blue)] hover:underline">← Voltar para o dia</a>
      <a href={`/achados/categoria/${categoria}`} class="text-sm font-semibold text-slate-700 hover:underline">Ver histórico da categoria</a>
    </div>

    <EditionPage edition={edition} showHighlights={false} />
  </section>
</Layout>
