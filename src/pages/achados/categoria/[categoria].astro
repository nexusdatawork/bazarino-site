---
import Layout from "../../../layouts/Layout.astro";
import EditionPage from "../../../components/EditionPage.astro";
import { listAllCategories, listCategoryEditions } from "@/lib/achadosSource";
import { titleFromSlug } from "@/lib/slug";

export function getStaticPaths() {
  return listAllCategories()
    .filter((c) => typeof c === "string" && c.trim().length > 0)
    .map((categoria) => ({
      params: { categoria },
    }));
}


const { categoria } = Astro.params;
const editions = listCategoryEditions(categoria);

// Monta uma ‚Äúedi√ß√£o virtual‚Äù pra renderizar com o mesmo template (lista), mantendo padr√£o de layout
const title = `Hist√≥rico: ${titleFromSlug(categoria)}`;

const virtualEdition = {
  date: editions[0]?.date ?? "‚Äî",
  type: "category",
  category: categoria,
  title,
  kicker: "Explorar por categoria ‚Ä¢ hist√≥rico de edi√ß√µes üìö",
  intro:
    `Aqui est√£o as edi√ß√µes j√° publicadas para ${titleFromSlug(categoria)}. ` +
    "Quando sair uma edi√ß√£o nova, ela aparece automaticamente aqui.",
  outro:
    "Dica: volte sempre. Quando o radar achar algo realmente bom nessa categoria, ele entra no hist√≥rico.",
  methodologyTitle: "O que voc√™ encontra aqui",
  methodology: [
    "Edi√ß√µes por data (quando houver publica√ß√£o).",
    "Links diretos para o Top da categoria em cada dia.",
    "Curadoria com score de custo-benef√≠cio."
  ],
  ctaText: "Quer sugerir uma categoria nova? Me manda por aqui üëá",
  ctaLink: "/contato",
  items: (editions[0]?.items ? editions[0].items : [])
};
---


<Layout title={title}>
  {editions.length === 0 ? (
    <section class="space-y-4">
      <h1 class="text-2xl font-semibold">{title}</h1>
      <p class="text-slate-600">
        Ainda n√£o temos edi√ß√µes para essa categoria.
      </p>
      <a class="underline" href="/achados">Voltar para Achados</a>
    </section>
  ) : (
    <section class="space-y-8">
      <header class="space-y-2">
        <p class="text-sm text-slate-600">Total de edi√ß√µes: {editions.length}</p>
        <h1 class="text-2xl font-semibold">{title}</h1>
        <p class="max-w-3xl text-slate-700">
          Clique em uma data para ver o Top da categoria naquele dia.
        </p>
      </header>

      <div class="rounded-xl border border-slate-200 overflow-hidden">
        <div class="bg-slate-50 px-4 py-3 text-xs font-semibold uppercase tracking-wide text-slate-600">
          Edi√ß√µes
        </div>
        <div class="divide-y divide-slate-200">
          {editions.map((e) => {
            const [ano, mes, dia] = e.date.split("-");
            return (
              <a
                class="block px-4 py-4 hover:bg-slate-50 transition"
                href={`/achados/${ano}/${mes}/${dia}/${categoria}`}
              >
                <div class="flex items-center justify-between">
                  <div>
                    <p class="font-semibold text-slate-900">{e.title}</p>
                    <p class="text-sm text-slate-600">{e.date}</p>
                  </div>
                  <span class="text-sm underline">Abrir</span>
                </div>
              </a>
            );
          })}
        </div>
      </div>

      {/* opcional: mostra a edi√ß√£o mais recente abaixo, usando o layout padr√£o */}
      <section class="space-y-4">
        <h2 class="text-lg font-semibold">√öltima edi√ß√£o da categoria</h2>
        <EditionPage edition={editions[0]} showHighlights={false} />
      </section>
    </section>
  )}
</Layout>

