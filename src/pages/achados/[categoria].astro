---
import Layout from "../../layouts/Layout.astro";
import { achadosCategories } from "../../data/achadosCategories";
import { getAchadosByCategory } from "../../data/achados";

// 1) SSG: diz ao Astro quais categorias existem e quais páginas gerar
export function getStaticPaths() {
  return achadosCategories.map((c) => ({
    params: { categoria: c.slug },
  }));
}

// 2) Em runtime (durante render), Astro.params vai ter o slug definido acima
const { categoria } = Astro.params;

const current = achadosCategories.find((c) => c.slug === categoria);
// Se alguém acessar algo fora da lista (depois de build), redireciona
if (!current) return Astro.redirect("/404");

const items = getAchadosByCategory(current.slug);
---

<Layout title={`Achados: ${current.title}`}>
  <section class="space-y-8">
    <header>
      <a href="/achados" class="text-sm underline">← Voltar para Achados</a>
      <h1 class="mt-4 text-2xl font-semibold">{current.title}</h1>
      <p class="mt-3 text-slate-600 max-w-3xl">{current.description}</p>
    </header>

    {items.length === 0 ? (
      <p class="text-slate-600">Ainda não há achados nesta categoria.</p>
    ) : (
      <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        {items.map((item) => (
          <article class="rounded-lg border border-slate-200 p-4 hover:border-slate-300">
            <h2 class="font-semibold leading-snug">{item.title}</h2>
            <p class="mt-2 text-sm text-slate-600">{item.store}</p>
            <p class="mt-3 font-semibold">R$ {item.price.toFixed(2)}</p>
            <a class="mt-3 inline-block text-sm underline" href={item.href} target="_blank" rel="noreferrer">
              Ver oferta
            </a>
          </article>
        ))}
      </div>
    )}
  </section>
</Layout>
